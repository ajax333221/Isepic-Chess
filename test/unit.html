<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Isepic Chess - Unit Tests</title>
		<link rel="stylesheet" href="../css/default.css">
		<script src="../js/jquery-3.3.1.min.js"></script>
		<script src="../js/isepic-chess.js"></script>
		<script>
			function testDisambiguation(){
				var board, error_msg;
				
				error_msg="";
				
				board=IsepicChess.initBoard({
					name : "board_testDis",
					fen : "6k1/8/8/2B1B3/8/2BKB2r/8/8 w - - 0 1",
					isHidden : true,
					invalidFenStop : true
				});
				
				//if(!error_msg){
					if(board===null){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [0] failed to initBoard()";
					}
				//}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("c3"), IsepicChess.bosToPos("d4"));
					board.moveCaller(IsepicChess.bosToPos("h3"), IsepicChess.bosToPos("g3"));
					board.moveCaller(IsepicChess.bosToPos("d4"), IsepicChess.bosToPos("c3"));
					board.moveCaller(IsepicChess.bosToPos("g3"), IsepicChess.bosToPos("h3"));
					board.moveCaller(IsepicChess.bosToPos("e5"), IsepicChess.bosToPos("d4"));
					board.moveCaller(IsepicChess.bosToPos("h3"), IsepicChess.bosToPos("f3"));
					board.moveCaller(IsepicChess.bosToPos("d4"), IsepicChess.bosToPos("e5"));
					board.moveCaller(IsepicChess.bosToPos("f3"), IsepicChess.bosToPos("g3"));
					board.moveCaller(IsepicChess.bosToPos("c5"), IsepicChess.bosToPos("d4"));
					
					if((board.MoveList[1].PGNmove+board.MoveList[5].PGNmove+board.MoveList[9].PGNmove)!=="B3d4Bed4Bc5d4"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [1] "+(board.MoveList[1].PGNmove+board.MoveList[5].PGNmove+board.MoveList[9].PGNmove)+" !== B3d4Bed4Bc5d4";
					}
				}
				
				IsepicChess.removeBoard(board.BoardName);
				
				return (error_msg ? ("<span class='redColor'>"+error_msg+"</span>") : "Test testDisambiguation() was successful.");
			}
			
			function testBasicFunctionality(){
				var board, error_msg;
				
				error_msg="";
				
				board=IsepicChess.initBoard({
					name : "board_testBas",
					fen : "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
					isRotated : true,
					isHidden : true,
					invalidFenStop : true
				});
				
				//if(!error_msg){
					if(board===null){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [0] failed to initBoard()";
					}
				//}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("e2"), IsepicChess.bosToPos("e4"));
					board.moveCaller(IsepicChess.bosToPos("f7"), IsepicChess.bosToPos("f5"));
					board.moveCaller(IsepicChess.bosToPos("d1"), IsepicChess.bosToPos("h5"));
					
					if(board.Active.checks!==1){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [1] checks";
					}
				}
				
				if(!error_msg){
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("g7")).join("")!=="2,6"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [2] remove check via pawn blocking";
					}
				}
				
				if(!error_msg){
					if(JSON.stringify(board.MoveList)!=="[{\"Fen\":\"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\",\"PGNmove\":\"\",\"FromBos\":\"\",\"ToBos\":\"\"},{\"Fen\":\"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1\",\"PGNmove\":\"e4\",\"FromBos\":\"e2\",\"ToBos\":\"e4\"},{\"Fen\":\"rnbqkbnr/ppppp1pp/8/5p2/4P3/8/PPPP1PPP/RNBQKBNR w KQkq f6 0 2\",\"PGNmove\":\"f5\",\"FromBos\":\"f7\",\"ToBos\":\"f5\"},{\"Fen\":\"rnbqkbnr/ppppp1pp/8/5p1Q/4P3/8/PPPP1PPP/RNB1KBNR b KQkq - 1 2\",\"PGNmove\":\"Qh5+\",\"FromBos\":\"d1\",\"ToBos\":\"h5\"}]"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [3] movelist format, enpass, clocks";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("g7"), IsepicChess.bosToPos("g6"));
					board.moveCaller(IsepicChess.bosToPos("h5"), IsepicChess.bosToPos("g6"));
					
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("h7")).join("")!=="2,6"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [4] remove check via pawn capture";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("h7"), IsepicChess.bosToPos("g6"));
					board.moveCaller(IsepicChess.bosToPos("f1"), IsepicChess.bosToPos("b5"));
					board.moveCaller(IsepicChess.bosToPos("h8"), IsepicChess.bosToPos("h2"));
					board.moveCaller(IsepicChess.bosToPos("b5"), IsepicChess.bosToPos("d7"));
					
					if((IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("b8")).join("")+IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("c8")).join("")+IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("d8")).join("")+IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("e8")).join(""))!=="1,31,31,31,51,3"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [5] remove check via (knight, bishop, queen, king) capture and via (king) moving out of check";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("e8"), IsepicChess.bosToPos("f7"));
					board.moveCaller(IsepicChess.bosToPos("e4"), IsepicChess.bosToPos("f5"));
					board.moveCaller(IsepicChess.bosToPos("h2"), IsepicChess.bosToPos("h6"));
					board.moveCaller(IsepicChess.bosToPos("g1"), IsepicChess.bosToPos("f3"));
					board.moveCaller(IsepicChess.bosToPos("a7"), IsepicChess.bosToPos("a5"));
					board.moveCaller(IsepicChess.bosToPos("f5"), IsepicChess.bosToPos("g6"));
					board.moveCaller(IsepicChess.bosToPos("f7"), IsepicChess.bosToPos("f6"));
					board.moveCaller(IsepicChess.bosToPos("g6"), IsepicChess.bosToPos("g7"));
					board.moveCaller(IsepicChess.bosToPos("a8"), IsepicChess.bosToPos("a6"));
					board.moveCaller(IsepicChess.bosToPos("d7"), IsepicChess.bosToPos("e8"));
					board.moveCaller(IsepicChess.bosToPos("f6"), IsepicChess.bosToPos("f5"));
					board.moveCaller(IsepicChess.bosToPos("e8"), IsepicChess.bosToPos("f7"));
					board.moveCaller(IsepicChess.bosToPos("h6"), IsepicChess.bosToPos("c6"));
					
					board.setPromoteTo(4);
					
					board.moveCaller(IsepicChess.bosToPos("g7"), IsepicChess.bosToPos("f8"));
					
					if(board.MoveList[board.MoveList.length-1].PGNmove!=="gxf8=R"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [6] underpromote to rook";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("a5"), IsepicChess.bosToPos("a4"));
					board.moveCaller(IsepicChess.bosToPos("f7"), IsepicChess.bosToPos("g6"));
					
					if(board.Active.checks!==2){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [7] 2 active checks via discovered check";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("f5"), IsepicChess.bosToPos("g6"));
					board.moveCaller(IsepicChess.bosToPos("e1"), IsepicChess.bosToPos("g1"));
					
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("a4")).join("")!=="5,0"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [8] prevent pawn capture moving forward";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("a6"), IsepicChess.bosToPos("b6"));
					
					if(board.MoveList[board.MoveList.length-1].PGNmove!=="Rab6"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [9] pgn disambiguation";
					}
				}
				
				if(!error_msg){
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("b2")).join("")!=="5,14,1"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [10] pawn can move two squares";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("b2"), IsepicChess.bosToPos("b4"));
					
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("a4")).join("")!=="5,05,1"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [11] pawn can capture enpassant or move";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("c6"), IsepicChess.bosToPos("f6"));
					
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("f8")).join("")!=="0,40,31,52,50,6"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [12] rook movement with capture";
					}
				}
				
				if(!error_msg){
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("b1")).join("")!=="5,25,0"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [13] knight movement, prevent capture ally";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("a2"), IsepicChess.bosToPos("a3"));
					
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("a4")).join("")!==""){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [14] prevent pawn capture moving forward(again) and no enpassant";
					}
				}
				
				if(!error_msg){
					board.moveCaller(IsepicChess.bosToPos("b6"), IsepicChess.bosToPos("a6"));
					
					if(board.MoveList[board.MoveList.length-1].PGNmove!=="Ra6"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [15] no pgn disambiguation needed";
					}
				}
				
				if(!error_msg){
					if(IsepicChess.legalMoves(board.Fen, IsepicChess.bosToPos("b4")).join("")!=="3,1"){
						IsepicChess.removeBoard(board.BoardName);
						error_msg="Error [16] pawn can only move one square forward";
					}
				}
				
				/*nuevo: falta cloneBoard(), etc*/
				
				/*test castling rights*/
				/*test castling*/
				/*test all underpromotion*/
				/*test para piece movements*/
				
				IsepicChess.removeBoard(board.BoardName);
				
				return (error_msg ? ("<span class='redColor'>"+error_msg+"</span>") : "Test testBasicFunctionality() was successful.");
			}
			
			function testFenPositions(){
				var i, len, invalid_positions, error_msg;
				
				error_msg="";
				
				invalid_positions=["",
				"hi",
				"8/rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR x KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KkQq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w kqKQ - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w Kqky - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e4 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e9 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq x5 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNRw KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR wKQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq- 0 1",
				"8/8/8/8/8/8/8/8 b - - 0 1",
				"8/7k/8/8/8/8/8/8 b - - 0 1",
				"8/7K/8/8/8/8/8/8 b - - 0 1",
				"8/K6K/8/8/8/7k/8/8 b - - 0 1",
				"8/k6k/8/8/8/7K/8/8 b - - 0 1",
				"P7/8/7K/8/8/7k/8/8 b - - 0 1",
				"p7/8/7K/8/8/7k/8/8 b - - 0 1",
				"8/8/7K/8/8/7k/8/p7 b - - 0 1",
				"8/8/7K/8/8/7k/8/P7 b - - 0 1",
				"p7/8/7K/8/8/7k/8/P7 b - - 0 1",
				"P7/8/7K/8/8/7k/8/p7 b - - 0 1",
				"8/8/61K/8/8/7k/8/8 b - - 0 1",
				"8/8/K32P1/8/8/7k/8/8 b - - 0 1",
				"8/8/1K51/8/8/7k/8/8 b - - 0 1",
				"8/8/8K/8/8/7k/8/8 b - - 0 1",
				"8/8/K8/8/8/7k/8/8 b - - 0 1",
				"R7R/8/K7/8/8/7k/8/8 b - - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/1P6/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/1p6/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/R7/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/r7/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/7B/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/7b/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPPNPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPPnPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/1ppppppp/p7/8/7Q/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/1ppppppp/p7/8/7q/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"4k3/2pppppp/8/8/8/B7/BBBPPPPP/1B2KRRR w - - 0 1",
				"4k3/2pppppp/8/8/8/B7/BBBPPPPP/1B2KRQQ w - - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/8/PP6/1NPRPPBR/RNBQKBNR w KQkq - 0 1",
				"8/8/4R3/2K5/3N2B1/8/4k3/8 b - - 0 1",
				"8/7q/8/1k1p4/4K3/6n1/8/8 w - - 0 1",
				"8/7q/5n2/1k1p4/4K3/6n1/8/4r3 w - - 0 1",
				"8/8/8/1K6/5k2/6P1/8/8 w - - 0 1",
				"8/8/8/1K6/1r3k2/8/8/8 b - - 0 1",
				"8/8/8/1K6/1r3k2/6P1/8/8 b - - 0 1",
				"8/8/8/1K6/1r3k2/6P1/8/8 w - - 0 1",
				"8/8/4N3/1K6/5k2/8/8/8 w - - 0 1",
				"8/8/4K3/4k3/8/8/8/8 w - - 0 1",
				"8/8/2K5/8/6P1/2k5/8/8 w - g3 0 1",
				"8/8/2K5/6p1/6P1/2k5/8/8 b - g6 0 1",
				"8/8/2K5/8/8/2k5/8/8 w - g6 0 1",
				"8/8/2K3N1/6p1/8/2k5/8/8 w - g6 0 1",
				"8/8/2K3N1/6p1/6P1/2k3n1/8/8 b - g3 0 1",
				"8/8/2K5/8/6p1/2k5/8/8 w - g3 0 1",
				"8/8/2K5/8/6p1/2k5/8/8 b - g3 0 1",
				"8/8/2K5/6P1/8/2k5/8/8 w - g6 0 1",
				"8/8/2K5/6P1/8/2k5/8/8 b - g6 0 1",
				"8/7P/2k4P/7P/7P/2K4P/7P/8 w - - 0 1",
				"8/P7/P1k5/P7/P7/P1K5/P7/8 w - - 0 1",
				"3knbnr/2pppppp/8/P7/P7/P3K3/P7/8 w - - 0 1",
				"8/7p/2k4p/7p/7p/7p/PPPPPP2/K7 w - - 0 1",
				"rnbq1rk1/ppppppbp/5np1/8/8/4P3/PPPPP1PP/4K3 w - - 0 1",
				"rnbq1rk1/1pppppbp/5np1/8/4P3/4P3/PPP1P1PP/4K3 w - - 0 1",
				"rnbq1rk1/3pppbp/5np1/4P3/4P3/4P3/PP2P1PP/4K3 w - - 0 1",
				"4K3/8/8/8/8/4k3/8/8 w KQ - 0 1",
				"8/4K3/8/8/8/8/8/4k3 w kq - 0 1",
				"8/8/2k5/8/8/8/8/4K2R w Q - 0 1",
				"8/8/2k5/8/8/8/8/r3K3 w K - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w K - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w Q - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w KQ - 0 1",
				"4K3/8/2k5/8/8/8/8/R6R w KQ - 0 1",
				"r6r/8/8/8/2K5/8/8/4k3 w kq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 0",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 1 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 00 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 5 3",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -0 1",
				"rnbqkb1r/pppppppp/8/8/3N1n2/8/PPPPPPPP/RNBQKB1R b KQkq - 8 4",
				"rnbqkb1r/pppppppp/8/5N2/5n2/8/PPPPPPPP/RNBQKB1R w KQkq - 7 4"];
				
				for(i=0, len=invalid_positions.length; i<len; i++){
					if(IsepicChess.isLegalFen(invalid_positions[i])){
						error_msg="Error ["+i+"] \""+invalid_positions[i]+"\" wasn't caught.";
						break;
					}
				}
				
				return (error_msg ? ("<span class='redColor'>"+error_msg+"</span>") : "Test testFenPositions() was successful.");
			}
			
			$(function(){
				var start_time, end_time, test_dis, test_basic, test_fen;
				
				if(!window.IsepicChess){
					console.log("Error: IsepicChess is not defined");
				}else{
					start_time=new Date().getTime();
					
					test_dis=testDisambiguation();
					test_basic=testBasicFunctionality();
					test_fen=testFenPositions();
					
					end_time=new Date().getTime();
					
					$("body").html("<div id='xtests'><h2>"+test_dis+"<br>"+test_basic+"<br>"+test_fen+"</h2><span>"+(end_time-start_time)+" ms</span>");
				}
			});
		</script>
	</head>
	<body>
	</body>
</html>
