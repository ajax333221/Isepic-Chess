<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Isepic Chess - Test</title>
		
		<link rel="stylesheet" href="../jQuery/jquery-ui-1.9.2.custom.min.css" type="text/css" />
		<link rel="stylesheet" href="../css/default.css" type="text/css" />
		
		<script src="../jQuery/jquery-1.8.3.min.js" type="text/javascript"></script>
		<script src="../jQuery/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
		<script src="../isepic-chess.js" type="text/javascript"></script>
		
		<script type="text/javascript">
			function testDisambiguation(){
				var board;
				
				board=initBoard({
					name : "board_testDis",
					fen : "6k1/8/8/2B1B3/8/2BKB2r/8/8 w - - 0 1",
					isHidden : true,
					invalidFenStop : true
				});
				
				if(!board){
					removeBoard(board);
					return "Error [0] failed to initBoard()";
				}
				
				board.moveCaller(bosToPos("c3"), bosToPos("d4"));
				board.moveCaller(bosToPos("h3"), bosToPos("g3"));
				board.moveCaller(bosToPos("d4"), bosToPos("c3"));
				board.moveCaller(bosToPos("g3"), bosToPos("h3"));
				board.moveCaller(bosToPos("e5"), bosToPos("d4"));
				board.moveCaller(bosToPos("h3"), bosToPos("f3"));
				board.moveCaller(bosToPos("d4"), bosToPos("e5"));
				board.moveCaller(bosToPos("f3"), bosToPos("g3"));
				board.moveCaller(bosToPos("c5"), bosToPos("d4"));
				
				if((board.MoveList[1].PGNmove+board.MoveList[5].PGNmove+board.MoveList[9].PGNmove)!="B3d4Bed4Bc5d4"){
					removeBoard(board);
					return "Error [1] "+(board.MoveList[1].PGNmove+board.MoveList[5].PGNmove+board.MoveList[9].PGNmove)+" != B3d4Bed4Bc5d4";
				}
				
				removeBoard(board);
				return "Test testDisambiguation() was successful.";
			}
			
			function testBasicFunctionality(){
				var board;
				
				board=initBoard({
					name : "board_testBas",
					fen : "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
					isRotated : true,
					isHidden : true,
					invalidFenStop : true
				});
				
				if(!board){
					removeBoard(board);
					return "Error [0] failed to initBoard()";
				}
				
				board.moveCaller(bosToPos("e2"), bosToPos("e4"));
				board.moveCaller(bosToPos("f7"), bosToPos("f5"));
				board.moveCaller(bosToPos("d1"), bosToPos("h5"));
				
				if(board.Active.checks!=1){
					removeBoard(board);
					return "Error [1] checks";
				}
				
				if(legalMoves(board.Fen, bosToPos("g7")).join("")!="2,6"){
					removeBoard(board);
					return "Error [2] remove check via pawn blocking";
				}
				
				if(JSON.stringify(board.MoveList)!="[{\"Fen\":\"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\",\"PGNmove\":\"\",\"FromBos\":\"\",\"ToBos\":\"\"},{\"Fen\":\"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1\",\"PGNmove\":\"e4\",\"FromBos\":\"e2\",\"ToBos\":\"e4\"},{\"Fen\":\"rnbqkbnr/ppppp1pp/8/5p2/4P3/8/PPPP1PPP/RNBQKBNR w KQkq f6 0 2\",\"PGNmove\":\"f5\",\"FromBos\":\"f7\",\"ToBos\":\"f5\"},{\"Fen\":\"rnbqkbnr/ppppp1pp/8/5p1Q/4P3/8/PPPP1PPP/RNB1KBNR b KQkq - 1 2\",\"PGNmove\":\"Qh5+\",\"FromBos\":\"d1\",\"ToBos\":\"h5\"}]"){
					removeBoard(board);
					return "Error [3] movelist format, enpass, clocks";
				}
				
				board.moveCaller(bosToPos("g7"), bosToPos("g6"));
				board.moveCaller(bosToPos("h5"), bosToPos("g6"));
				
				if(legalMoves(board.Fen, bosToPos("h7")).join("")!="2,6"){
					removeBoard(board);
					return "Error [4] remove check via pawn capture";
				}
				
				board.moveCaller(bosToPos("h7"), bosToPos("g6"));
				board.moveCaller(bosToPos("f1"), bosToPos("b5"));
				board.moveCaller(bosToPos("h8"), bosToPos("h2"));
				board.moveCaller(bosToPos("b5"), bosToPos("d7"));
				
				if((legalMoves(board.Fen, bosToPos("b8")).join("")+legalMoves(board.Fen, bosToPos("c8")).join("")+legalMoves(board.Fen, bosToPos("d8")).join("")+legalMoves(board.Fen, bosToPos("e8")).join(""))!="1,31,31,31,51,3"){
					removeBoard(board);
					return "Error [5] remove check via (knight, bishop, queen, king) capture and via (king) moving out of check";
				}
				
				board.moveCaller(bosToPos("e8"), bosToPos("f7"));
				board.moveCaller(bosToPos("e4"), bosToPos("f5"));
				board.moveCaller(bosToPos("h2"), bosToPos("h6"));
				board.moveCaller(bosToPos("g1"), bosToPos("f3"));
				board.moveCaller(bosToPos("a7"), bosToPos("a5"));
				board.moveCaller(bosToPos("f5"), bosToPos("g6"));
				board.moveCaller(bosToPos("f7"), bosToPos("f6"));
				board.moveCaller(bosToPos("g6"), bosToPos("g7"));
				board.moveCaller(bosToPos("a8"), bosToPos("a6"));
				board.moveCaller(bosToPos("d7"), bosToPos("e8"));
				board.moveCaller(bosToPos("f6"), bosToPos("f5"));
				board.moveCaller(bosToPos("e8"), bosToPos("f7"));
				board.moveCaller(bosToPos("h6"), bosToPos("c6"));
				
				board.setPromoteTo(4);
				
				board.moveCaller(bosToPos("g7"), bosToPos("f8"));
				
				if(board.MoveList[board.MoveList.length-1].PGNmove!="gxf8=R"){
					removeBoard(board);
					return "Error [6] underpromote to rook";
				}
				
				board.moveCaller(bosToPos("a5"), bosToPos("a4"));
				board.moveCaller(bosToPos("f7"), bosToPos("g6"));
				
				if(board.Active.checks!=2){
					removeBoard(board);
					return "Error [7] 2 active checks via discovered check";
				}
				
				board.moveCaller(bosToPos("f5"), bosToPos("g6"));
				board.moveCaller(bosToPos("e1"), bosToPos("g1"));
				
				if(legalMoves(board.Fen, bosToPos("a4")).join("")!="5,0"){
					removeBoard(board);
					return "Error [8] prevent pawn capture moving forward";
				}
				
				board.moveCaller(bosToPos("a6"), bosToPos("b6"));
				
				if(board.MoveList[board.MoveList.length-1].PGNmove!="Rab6"){
					removeBoard(board);
					return "Error [9] pgn disambiguation";
				}
				
				if(legalMoves(board.Fen, bosToPos("b2")).join("")!="5,14,1"){
					removeBoard(board);
					return "Error [10] pawn can move two squares";
				}
				
				board.moveCaller(bosToPos("b2"), bosToPos("b4"));
				
				if(legalMoves(board.Fen, bosToPos("a4")).join("")!="5,05,1"){
					removeBoard(board);
					return "Error [11] pawn can capture enpassant or move";
				}
				
				board.moveCaller(bosToPos("c6"), bosToPos("f6"));
				
				if(legalMoves(board.Fen, bosToPos("f8")).join("")!="0,40,31,52,50,6"){
					removeBoard(board);
					return "Error [12] rook movement with capture";
				}
				
				if(legalMoves(board.Fen, bosToPos("b1")).join("")!="5,25,0"){
					removeBoard(board);
					return "Error [13] knight movement, prevent capture ally";
				}
				
				board.moveCaller(bosToPos("a2"), bosToPos("a3"));
				
				if(legalMoves(board.Fen, bosToPos("a4")).join("")!=""){
					removeBoard(board);
					return "Error [14] prevent pawn capture moving forward(again) and no enpassant";
				}
				
				board.moveCaller(bosToPos("b6"), bosToPos("a6"));
				
				if(board.MoveList[board.MoveList.length-1].PGNmove!="Ra6"){
					removeBoard(board);
					return "Error [15] no pgn disambiguation needed";
				}
				
				if(legalMoves(board.Fen, bosToPos("b4")).join("")!="3,1"){
					removeBoard(board);
					return "Error [16] pawn can only move one square forward";
				}
				
				/*test castling rights*/
				/*test castling*/
				/*test all underpromotion*/
				/*test para piece movements*/
				
				removeBoard(board);
				return "Test testBasicFunctionality() was successful.";
			}
			
			function testFenPositions(){
				var i, len, board, invalid_positions;
				
				invalid_positions=["",
				"hi",
				"8/rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR x KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KkQq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w kqKQ - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w Kqky - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e4 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq e9 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq x5 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNRw KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR wKQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq- 0 1",
				"8/8/8/8/8/8/8/8 b - - 0 1",
				"8/7k/8/8/8/8/8/8 b - - 0 1",
				"8/7K/8/8/8/8/8/8 b - - 0 1",
				"8/K6K/8/8/8/7k/8/8 b - - 0 1",
				"8/k6k/8/8/8/7K/8/8 b - - 0 1",
				"P7/8/7K/8/8/7k/8/8 b - - 0 1",
				"p7/8/7K/8/8/7k/8/8 b - - 0 1",
				"8/8/7K/8/8/7k/8/p7 b - - 0 1",
				"8/8/7K/8/8/7k/8/P7 b - - 0 1",
				"p7/8/7K/8/8/7k/8/P7 b - - 0 1",
				"P7/8/7K/8/8/7k/8/p7 b - - 0 1",
				"8/8/61K/8/8/7k/8/8 b - - 0 1",
				"8/8/K32P1/8/8/7k/8/8 b - - 0 1",
				"8/8/1K51/8/8/7k/8/8 b - - 0 1",
				"8/8/8K/8/8/7k/8/8 b - - 0 1",
				"8/8/K8/8/8/7k/8/8 b - - 0 1",
				"R7R/8/K7/8/8/7k/8/8 b - - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/1P6/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/1p6/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/R7/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/r7/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/7B/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/7b/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPPNPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPPnPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/1ppppppp/p7/8/7Q/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"rnbqkbnr/1ppppppp/p7/8/7q/P7/1PPPPPPP/RNBQKBNR w KQkq - 0 1",
				"4k3/2pppppp/8/8/8/B7/BBBPPPPP/1B2KRRR w - - 0 1","4k3/2pppppp/8/8/8/B7/BBBPPPPP/1B2KRQQ w - - 0 1",
				"rnbqkbnr/pppp1ppp/8/4p3/8/PP6/1NPRPPBR/RNBQKBNR w KQkq - 0 1","8/8/4R3/2K5/3N2B1/8/4k3/8 b - - 0 1",
				"8/7q/8/1k1p4/4K3/6n1/8/8 w - - 0 1","8/7q/5n2/1k1p4/4K3/6n1/8/4r3 w - - 0 1",
				"8/8/8/1K6/5k2/6P1/8/8 w - - 0 1",
				"8/8/8/1K6/1r3k2/8/8/8 b - - 0 1",
				"8/8/8/1K6/1r3k2/6P1/8/8 b - - 0 1",
				"8/8/8/1K6/1r3k2/6P1/8/8 w - - 0 1",
				"8/8/4N3/1K6/5k2/8/8/8 w - - 0 1",
				"8/8/4K3/4k3/8/8/8/8 w - - 0 1",
				"8/8/2K5/8/6P1/2k5/8/8 w - g3 0 1",
				"8/8/2K5/6p1/6P1/2k5/8/8 b - g6 0 1",
				"8/8/2K5/8/8/2k5/8/8 w - g6 0 1",
				"8/8/2K3N1/6p1/8/2k5/8/8 w - g6 0 1",
				"8/8/2K3N1/6p1/6P1/2k3n1/8/8 b - g3 0 1",
				"8/8/2K5/8/6p1/2k5/8/8 w - g3 0 1",
				"8/8/2K5/8/6p1/2k5/8/8 b - g3 0 1",
				"8/8/2K5/6P1/8/2k5/8/8 w - g6 0 1",
				"8/8/2K5/6P1/8/2k5/8/8 b - g6 0 1",
				"8/7P/2k4P/7P/7P/2K4P/7P/8 w - - 0 1",
				"8/P7/P1k5/P7/P7/P1K5/P7/8 w - - 0 1",
				"3knbnr/2pppppp/8/P7/P7/P3K3/P7/8 w - - 0 1",
				"8/7p/2k4p/7p/7p/7p/PPPPPP2/K7 w - - 0 1",
				"rnbq1rk1/ppppppbp/5np1/8/8/4P3/PPPPP1PP/4K3 w - - 0 1",
				"rnbq1rk1/1pppppbp/5np1/8/4P3/4P3/PPP1P1PP/4K3 w - - 0 1",
				"rnbq1rk1/3pppbp/5np1/4P3/4P3/4P3/PP2P1PP/4K3 w - - 0 1",
				"4K3/8/8/8/8/4k3/8/8 w KQ - 0 1",
				"8/4K3/8/8/8/8/8/4k3 w kq - 0 1",
				"8/8/2k5/8/8/8/8/4K2R w Q - 0 1",
				"8/8/2k5/8/8/8/8/r3K3 w K - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w K - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w Q - 0 1",
				"8/8/2k5/8/8/8/8/4K3 w KQ - 0 1",
				"4K3/8/2k5/8/8/8/8/R6R w KQ - 0 1",
				"r6r/8/8/8/2K5/8/8/4k3 w kq - 0 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 0",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 1 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 00 1",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 5 3",
				"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq -0 1",
				"rnbqkb1r/pppppppp/8/8/3N1n2/8/PPPPPPPP/RNBQKB1R b KQkq - 8 4",
				"rnbqkb1r/pppppppp/8/5N2/5n2/8/PPPPPPPP/RNBQKB1R w KQkq - 7 4"];
				
				for(i=0, len=invalid_positions.length; i<len; i++){
					board=initBoard({
						name : "board_testFens",
						fen : invalid_positions[i],
						isHidden : true
					});
					
					if(!board){
						removeBoard(board);
						return "Error [0] failed to initBoard()";
					}
					
					if(board.Fen!=="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"){
						removeBoard(board);
						return "Error: ["+i+"] \""+board.Fen+"\" wasn't caught.";
					}
				}
				
				removeBoard(board);
				return "Test testFenPositions() was successful.";
			}
			
			$(function(){
				var start_time, end_time, test_dis, test_basic, test_fen;
				
				start_time=new Date().getTime();
				//---
				test_dis=testDisambiguation();
				test_basic=testBasicFunctionality();
				test_fen=testFenPositions();
				//---
				end_time=new Date().getTime();
				
				$("body").html("<h2 style='padding-top:50px;text-align:center;'>"+test_dis+"<br>"+test_basic+"<br>"+test_fen+"<br>"+(end_time-start_time)+"</h2>");
			});
		</script>
	</head>
	<body>
	</body>
</html>
